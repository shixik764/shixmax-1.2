<!doctype html><html lang="ru"><head><meta charset="utf-8'><meta name="viewport" content="width=device-width,initial-scale=1"><title>Shixmax ‚Äî –ì–ª–∞–≤–Ω–∞—è</title><link rel="stylesheet" href="styles.css"></head><body>
<div class="header"><div class="brand">Shixmax</div><div style="display:flex;gap:8px;align-items:center"><button id="themeBtn" class="filebtn">üåì</button><button id="logoutBtn" class="filebtn">–í—ã–π—Ç–∏</button></div></div>
<div class="container">
  <aside class="sidebar">
    <div class="profile-box"><div class="avatar" id="myAvatar"><img id="myAvatarImg" src=""></div><div><div id="myName" style="font-weight:700"></div><div class="small" id="myEmail"></div></div></div>
    <div style="margin-top:10px"><button id="newChat" class="btn">–ù–æ–≤—ã–π —á–∞—Ç</button></div>
    <ul id="roomsList" class="rooms"></ul>
    <div style="margin-top:14px"><a href="profile.html" class="small">–ü—Ä–æ—Ñ–∏–ª—å</a> ¬∑ <a href="settings.html" class="small">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></div>
  </aside>
  <main class="main"><div class="center"><div class="small">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç —Å–ª–µ–≤–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π.</div></div></main>
</div>
<script src="firebase.js"></script>
<script>
const themeBtn=document.getElementById('themeBtn');
if(localStorage.getItem('shix_theme')==='dark') document.body.classList.add('dark');
themeBtn.addEventListener('click', ()=>{ document.body.classList.toggle('dark'); localStorage.setItem('shix_theme', document.body.classList.contains('dark')?'dark':'light'); });

auth.onAuthStateChanged(async user=>{
  if(!user) return location.href='index.html';
  const uid=user.uid;
  const p = (await db.ref('profiles/'+uid).once('value')).val()||{};
  document.getElementById('myName').textContent = p.name || user.email;
  if(p.avatar) document.getElementById('myAvatarImg').src = p.avatar;
  document.getElementById('myEmail').textContent = user.email||'';
  db.ref('rooms_meta').on('value', snap=>{ const v=snap.val()||{}; const list=document.getElementById('roomsList'); list.innerHTML=''; Object.keys(v).forEach(k=>{ const li=document.createElement('li'); li.className='room'; li.textContent=k; li.addEventListener('click', ()=> location.href='chat.html?room='+encodeURIComponent(k)); list.appendChild(li); }); });
});
document.getElementById('newChat').addEventListener('click', ()=>{ const name=prompt('–ò–º—è –Ω–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã:'); if(!name) return; const pwd=prompt('–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)')||''; db.ref('rooms_meta/'+name).set({ created:Date.now(), password: pwd||null }); location.href='chat.html?room='+encodeURIComponent(name); });
document.getElementById('logoutBtn').addEventListener('click', ()=>{ auth.signOut().then(()=>location.href='index.html'); });
</script></body></html>
